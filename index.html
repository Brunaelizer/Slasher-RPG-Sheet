<!DOCTYPE html>
<html lang="pt-br" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Slasher RPG Sheet</title>
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous" />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"></script>

    <link rel="stylesheet" href="style.css" />
  </head>
  <body class="bg-dark-subtle">
    <div class="container container-lg main bg-dark">
      <div class="row header gap-3 row-gap-8">
        <div class="col title"><h1>Ficha RPG Slasher</h1></div>
        <div class="col d-grid gap-2 d-md-block">
          <button
            type="button"
            id="btn-edit"
            class="btn btn-outline-light"
            data-bs-toggle="button">
            Edit
          </button>
          <button class="btn btn-success" type="button" id="btn-salvar">
            Salvar
          </button>
          <input
            type="file"
            id="btn-abrir"
            accept=".json"
            style="display: none" />
          <label for="btn-abrir" class="btn btn-primary">Abrir</label>
        </div>
      </div>
      <div class="row container sheet-body">
        <div class="col left-column">
          <div class="name row row-element">
            <div class="col form-floating mb-2">
              <input type="text" class="form-control" id="f_personagem" />
              <label for="f_personagem">Personagem</label>
            </div>
            <div class="col form-floating">
              <input type="text" class="form-control" id="f_player" />
              <label for="f_player">Player</label>
            </div>
          </div>
          <div class="stats row row-element">
            <div class="col main-stats">
              <div class="row">
                <div class="col">
                  <label>Vida</label>
                  <div class="input-group">
                    <input
                      type="number"
                      name=""
                      id="f_vida_atual"
                      class="form-control border-success" />
                    <span class="input-group-text border-success">/</span>
                    <input
                      type="number"
                      name=""
                      id="f_vida_total"
                      class="form-control border-success" />
                  </div>
                </div>
                <div class="col">
                  <label>Vigor</label>
                  <div class="input-group border-primary">
                    <input
                      type="number"
                      name=""
                      id="f_vigor_atual"
                      class="form-control border-primary" />
                    <span class="input-group-text border-primary">/</span>
                    <input
                      type="number"
                      name=""
                      id="f_vigor_total"
                      class="form-control border-primary" />
                  </div>
                </div>
              </div>
            </div>
            <div class="col medo-stat">
              <br />
              <button
                type="button"
                id="btn-medo"
                class="btn btn-outline-danger"
                data-bs-toggle="button">
                Medo</button
              ><br />
            </div>
          </div>

          <div class="ability row-element">
            <div class="row row-cols-auto">
              <div class="col border ability-div">
                <label for="">Força</label><br /><input
                  type="number"
                  class="form-control habilidade"
                  id="f_forca"
                  value="0"
                  max="3" />
              </div>
              <div class="col border ability-div">
                <label for="">Agilidade</label><br /><input
                  type="number"
                  class="form-control habilidade"
                  id="f_agilidade"
                  value="0"
                  max="3" />
              </div>
              <div class="col border ability-div">
                <label for="">Inteligencia</label><br /><input
                  type="number"
                  class="form-control habilidade"
                  id="f_inteligencia"
                  value="0"
                  max="3" />
              </div>
              <div class="col border ability-div">
                <label for="">Constituição</label><br /><input
                  type="number"
                  class="form-control habilidade"
                  id="f_constituicao"
                  value="0"
                  max="3" />
              </div>
            </div>
          </div>
          <div class="row status-gerais">
            <div class="col border-red status-div">
              <label for="">Proficiencia</label><br /><input
                type="number"
                readonly="readonly"
                class="form-control"
                id="f_proficiencia"
                value="2" />
            </div>
            <div class="col border-red status-div">
              <label for="">Resistência</label><br /><input
                type="number"
                readonly="readonly"
                class="form-control"
                id="f_resistencia"
                value="10" />
            </div>
            <div class="col border-red status-div">
              <label for="">Iniciativa</label><br /><input
                type="number"
                readonly="readonly"
                class="form-control"
                id="f_iniciativa"
                value="0" />
            </div>
          </div>

          <div class="skills row row-element">
            <div class="col">
              <label>Skills</label>
              <div class="row">
                <div class="col">
                  <div class="input-group flex-nowrap">
                    <div class="input-group-text">
                      <input
                        class="form-check-input mt-0 check-skill"
                        type="checkbox"
                        value="" />
                    </div>
                    <span class="input-group-text">Percepção</span>
                    <span class="input-group-text">INT</span>
                    <input
                      type="number"
                      id="f_skill_1"
                      class="form-control int"
                      value="0"
                      aria-label="Percepção" />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <div class="input-group flex-nowrap">
                    <div class="input-group-text">
                      <input
                        class="form-check-input mt-0 check-skill"
                        type="checkbox"
                        value="" />
                    </div>
                    <span class="input-group-text">Sobrevivência</span>
                    <span class="input-group-text">INT</span>
                    <input
                      type="number"
                      id="f_skill_2"
                      class="form-control int"
                      value="0"
                      aria-label="Sobrevivência" />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <div class="input-group flex-nowrap">
                    <div class="input-group-text">
                      <input
                        class="form-check-input mt-0 check-skill"
                        type="checkbox"
                        value=""
                        aria-label="Intuição" />
                    </div>
                    <span class="input-group-text">Intuição</span>
                    <span class="input-group-text">INT</span>
                    <input
                      type="number"
                      id="f_skill_3"
                      class="form-control int"
                      value="0"
                      aria-label="Intuição" />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <div class="input-group flex-nowrap">
                    <div class="input-group-text">
                      <input
                        class="form-check-input mt-0 check-skill"
                        type="checkbox"
                        value=""
                        aria-label="Atletismo" />
                    </div>
                    <span class="input-group-text">Atletismo</span>
                    <span class="input-group-text">AGI</span>
                    <input
                      type="number"
                      class="form-control agi"
                      id="f_skill_4"
                      value="0"
                      aria-label="Atletismo" />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <div class="input-group flex-nowrap">
                    <div class="input-group-text">
                      <input
                        class="form-check-input mt-0 check-skill"
                        type="checkbox"
                        value=""
                        aria-label="Checkbox for following text input" />
                    </div>
                    <span class="input-group-text">Furtividade</span>
                    <span class="input-group-text">AGI</span>
                    <input
                      type="number"
                      value="0"
                      class="form-control agi"
                      id="f_skill_5"
                      aria-label="Furtividade" />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <div class="input-group flex-nowrap">
                    <div class="input-group-text">
                      <input
                        class="form-check-input mt-0 check-skill"
                        type="checkbox"
                        value=""
                        aria-label="Enganação" />
                    </div>
                    <span class="input-group-text">Enganação</span>
                    <span class="input-group-text">INT</span>
                    <input
                      type="number"
                      id="f_skill_6"
                      class="form-control int"
                      value="0"
                      aria-label="Enganação" />
                  </div>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="row"><br /></div>
              <div class="row">
                <div class="col">
                  <div class="input-group flex-nowrap">
                    <div class="input-group-text">
                      <input
                        class="form-check-input mt-0 check-skill"
                        type="checkbox"
                        value=""
                        aria-label="Medicina" />
                    </div>
                    <span class="input-group-text">Medicina</span>
                    <span class="input-group-text">CON</span>
                    <input
                      type="number"
                      id="f_skill_7"
                      class="form-control con"
                      value="0"
                      aria-label="Medicina" />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <div class="input-group flex-nowrap">
                    <div class="input-group-text">
                      <input
                        class="form-check-input mt-0 check-skill"
                        type="checkbox"
                        value=""
                        aria-label="História/Religião" />
                    </div>
                    <span class="input-group-text">Hist./Religião</span>
                    <span class="input-group-text">INT</span>
                    <input
                      type="number"
                      class="form-control int"
                      id="f_skill_8"
                      value="0"
                      aria-label="História/Religião" />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <div class="input-group flex-nowrap">
                    <div class="input-group-text">
                      <input
                        class="form-check-input mt-0 check-skill"
                        type="checkbox"
                        value="" />
                    </div>
                    <span class="input-group-text">Luta</span>
                    <span class="input-group-text">FOR</span>
                    <input
                      type="number"
                      id="f_skill_9"
                      class="form-control for"
                      value="0"
                      aria-label="Luta" />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <div class="input-group flex-nowrap">
                    <div class="input-group-text">
                      <input
                        class="form-check-input mt-0 check-skill"
                        type="checkbox"
                        value="" />
                    </div>
                    <span class="input-group-text">Pontaria</span>
                    <span class="input-group-text">FOR</span>
                    <input
                      type="number"
                      id="f_skill_10"
                      class="form-control for"
                      value="0"
                      aria-label="Pontaria" />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <div class="input-group flex-nowrap">
                    <div class="input-group-text">
                      <input
                        class="form-check-input mt-0 check-skill"
                        type="checkbox"
                        value="" />
                    </div>
                    <span class="input-group-text">Tecnologia</span>
                    <span class="input-group-text">INT</span>
                    <input
                      type="number"
                      id="f_skill_11"
                      class="form-control int"
                      value="0"
                      aria-label="Tecnologia" />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <div class="input-group flex-nowrap">
                    <div class="input-group-text">
                      <input
                        class="form-check-input mt-0 check-skill"
                        type="checkbox"
                        value=""
                        aria-label="Crime" />
                    </div>
                    <span class="input-group-text">Crime</span>
                    <span class="input-group-text">INT</span>
                    <input
                      type="number"
                      class="form-control int"
                      id="f_skill_12"
                      value="0"
                      aria-label="Crime" />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col right-column">
          <div class="row">
            <div class="card" id="card-opcoes">
              <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs">
                  <li class="nav-item">
                    <a
                      class="nav-link active"
                      data-bs-toggle="tab"
                      aria-current="true"
                      href="#background"
                      >Background</a
                    >
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#inventario" data-bs-toggle="tab"
                      >Inventário</a
                    >
                  </li>
                </ul>
              </div>
              <div class="card-body">
                <div class="tab-content">
                  <div class="tab-pane fade" id="inventario">
                    <h3>Inventário</h3>
                    <button id="abrir-lista-item" class="btn btn-primary">
                      Adicionar itens
                    </button>
                    <ul id="inventario-lista" class="list-group mt-3"></ul>
                  </div>
                  <div class="tab-pane fade show active" id="background">
                    <div class="mb-3">
                      <label
                        for="exampleFormControlTextarea1"
                        class="form-label"
                        >Relacionamentos</label
                      >
                      <textarea
                        class="form-control"
                        id="exampleFormControlTextarea1"
                        rows="2"></textarea>
                    </div>
                    <div class="mb-3">
                      <label
                        for="exampleFormControlTextarea1"
                        class="form-label"
                        >Descrição personagem</label
                      >
                      <textarea
                        class="form-control"
                        id="exampleFormControlTextarea1"
                        rows="5"></textarea>
                    </div>
                    <div class="mb-3">
                      <label
                        for="exampleFormControlTextarea1"
                        class="form-label"
                        >História</label
                      >
                      <textarea
                        class="form-control"
                        id="exampleFormControlTextarea1"
                        rows="10"></textarea>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal -->
    <div
      class="modal fade"
      id="item-modal"
      tabindex="-1"
      aria-labelledby="item-modalLabel"
      aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="item-modalLabel">Selecionar itens</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="item-form">
              <!-- Itens -->
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="item1"
                  value="Antibiotico" />
                <label class="form-check-label" for="item1">Antibiotico</label>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal">
              Fechar
            </button>
            <button type="button" id="btn-add-item" class="btn btn-primary">
              Adicionar ao Inventário
            </button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>

<script>
  $(document).ready(function () {
    function addItem(itemName) {
      if (itemName) {
        const listItem = $(`
        <li class="list-group-item d-flex justify-content-between align-items-center">
          ${itemName}
          <button class="btn btn-danger btn-sm btn-remover-item">Remover</button>
        </li>
      `);
        $("#inventario-lista").append(listItem);
      }
    }

    $("#abrir-lista-item").click(function () {
      $("#item-modal").modal("show");
    });

    $("#btn-add-item").click(function () {
      $("#item-form input:checked").each(function () {
        const itemName = $(this).val();
        addItem(itemName);
        $(this).prop("checked", false);
      });

      $("#item-modal").modal("hide");
    });

    // Remove um item do inventário
    $("#inventario-lista").on("click", ".btn-remover-item", function () {
      $(this).closest("li").remove();
    });

    function getDados() {
      const dados = {
        personagem: $("#f_personagem").val(),
        player: $("#f_player").val(),
        vida: {
          atual: $("#f_vida_atual").val(),
          total: $("#f_vida_total").val(),
        },
        vigor: {
          atual: $("#f_vigor_atual").val(),
          total: $("#f_vigor_total").val(),
        },
        medo: $("#btn-medo").is(":checked"),
        habilidades: {
          forca: $("#f_forca").val(),
          agilidade: $("#f_agilidade").val(),
          inteligencia: $("#f_inteligencia").val(),
          constituicao: $("#f_constituicao").val(),
        },
        skills: {
          percepcao: $("#f_skill_1").val(),
          sobrevivencia: $("#f_skill_2").val(),
          intuicao: $("#f_skill_3").val(),
          atletismo: $("#f_skill_4").val(),
          furtividade: $("#f_skill_5").val(),
          enganacao: $("#f_skill_6").val(),
          medicina: $("#f_skill_7").val(),
          historia_religiao: $("#f_skill_8").val(),
          luta: $("#f_skill_9").val(),
          pontaria: $("#f_skill_10").val(),
          tecnologia: $("#f_skill_11").val(),
          crime: $("#f_skill_12").val(),
        },
        inventario: [],
      };

      $("#inventario-lista li").each(function () {
        const itemNome = $(this).contents().first().text().trim();
        dados.inventario.push(itemNome);
      });

      return dados;
    }

    function preencherFormulario(dados) {
      // Preenche os campos básicos
      $("#f_personagem").val(dados.personagem || "");
      $("#f_player").val(dados.player || "");
      $("#f_vida_atual").val(dados.vida?.atual || "");
      $("#f_vida_total").val(dados.vida?.total || "");
      $("#f_vigor_atual").val(dados.vigor?.atual || "");
      $("#f_vigor_total").val(dados.vigor?.total || "");
      $("#btn-medo").prop("checked", dados.medo || false);

      // Preenche as habilidades
      $("#f_forca").val(dados.habilidades?.forca || "");
      $("#f_agilidade").val(dados.habilidades?.agilidade || "");
      $("#f_inteligencia").val(dados.habilidades?.inteligencia || "");
      $("#f_constituicao").val(dados.habilidades?.constituicao || "");

      // Preenche as skills
      $("#f_skill_1").val(dados.skills?.percepcao || "");
      $("#f_skill_2").val(dados.skills?.sobrevivencia || "");
      $("#f_skill_3").val(dados.skills?.intuicao || "");
      $("#f_skill_4").val(dados.skills?.atletismo || "");
      $("#f_skill_5").val(dados.skills?.furtividade || "");
      $("#f_skill_6").val(dados.skills?.enganacao || "");
      $("#f_skill_7").val(dados.skills?.medicina || "");
      $("#f_skill_8").val(dados.skills?.historia_religiao || "");
      $("#f_skill_9").val(dados.skills?.luta || "");
      $("#f_skill_10").val(dados.skills?.pontaria || "");
      $("#f_skill_11").val(dados.skills?.tecnologia || "");
      $("#f_skill_12").val(dados.skills?.crime || "");

      const inventarioLista = $("#inventario-lista");
      inventarioLista.empty();
      if (Array.isArray(dados.inventario)) {
        dados.inventario.forEach((item) => {
          inventarioLista.append(`<li>${item}</li>`);
        });
      }
    }

    function lerArquivoJSON(event) {
      const arquivo = event.target.files[0];
      if (!arquivo) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        try {
          const dados = JSON.parse(e.target.result);
          preencherFormulario(dados);
        } catch (error) {
          alert("O arquivo JSON é inválido.");
        }
      };
      reader.readAsText(arquivo);
    }

    function downloadJSON(data, filename = "ficha.json") {
      const jsonData = JSON.stringify(data, null, 2);
      const blob = new Blob([jsonData], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    $("#btn-salvar").click(function () {
      const dadosFormulario = getDados();
      downloadJSON(dadosFormulario);
    });

    $("#btn-abrir").change(lerArquivoJSON);

    function calcularStatus() {
      debugger;
      $("#f_resistencia").val(10 + parseInt($("#f_constituicao").val()));
      $("#f_iniciativa").val(parseInt($("#f_agilidade").val()));

      $(".for").val(parseInt($("#f_forca").val()));
      $(".agi").val(parseInt($("#f_agilidade").val()));
      $(".int").val(parseInt($("#f_inteligencia").val()));
      $(".con").val(parseInt($("#f_constituicao").val()));

      var vida = (parseInt($("#f_constituicao").val()) * 12) / 2;
      $("#f_vida_total").val(vida);

      var vigor = 10 + parseInt($("#f_agilidade").val());
      $("#f_vigor_total").val(vigor);
    }

    $(this).on("change", ".check-skill", function () {
      var input = $(this).closest(".input-group").find('input[type="number"]');
      var total = parseInt(input.val());

      if ($(this).is(":checked")) {
        total += parseInt($("#f_proficiencia").val());
      } else {
        total -= parseInt($("#f_proficiencia").val());
      }

      input.val(total).change();
    });

    $("#btn-medo").on("click", function () {
      var indice = -1;
      if ($(this).hasClass("active")) {
        indice = indice * -1;
      }

      $("#f_inteligencia").val($("#f_inteligencia").val() - indice);
      $("#f_forca").val($("#f_forca").val() - indice * -1);

      $(".habilidade").trigger("change");
    });

    function botaoEdit(btn) {
      debugger;
      var ativo = true;
      console.log(btn);
      if ($(btn).hasClass("active")) {
        ativo = false;
      }
      $(".habilidade").prop("readonly", ativo);
    }

    $("#btn-edit").on("click", function () {
      botaoEdit(this);
    });

    botaoEdit($("#btn-edit"));

    $(".habilidade").on("change", function () {
      calcularStatus();
    });
  });
</script>
